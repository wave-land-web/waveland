<form id="subscribe" method="POST" class="max-w-96">
  <div class="flex gap-2 mb-2">
    <label for="email" class="sr-only">Email Address</label>
    <input
      id="email"
      class="block w-full border rounded-md border-grey p-2 text-darkBlue dark:text-white bg-transparent placeholder:text-grey focus:outline-none focus:ring-2 focus:ring-purple shadow-sm transition"
      name="email"
      type="email"
      autocomplete="email"
      placeholder="Email Address"
      required
    />
    <button class="site-button hover:text-white dark:hover:text-darkBlue">Subscribe</button>
  </div>
  <!-- TODO: handle response on form submission -->
  <span id="response" class="hidden text-xs"> </span>
</form>

<script>
  document.addEventListener('astro:page-load', () => {
    const form = document.querySelector('#subscribe') as HTMLFormElement
    const responseMessage = form?.querySelector('#response') as HTMLSpanElement

    // Submit handler
    async function submit(e: Event) {
      e.preventDefault()

      // Get form data
      const formData = new FormData(e.target as HTMLFormElement)

      // Show loading message
      responseMessage.classList.remove('success')
      responseMessage.classList.remove('error')
      responseMessage.textContent = 'Loading...'

      // Send form data to API
      const response = await fetch('/api/subscribe/', {
        method: 'POST',
        body: formData,
      })

      const data = await response.json()

      // Error subscribing
      if (data.error) {
        responseMessage.classList.remove('hidden')
        responseMessage.classList.remove('text-green')
        responseMessage.classList.add('text-orange')
        responseMessage.textContent = data.error
      }

      // Successful subscription
      if (data.message) {
        responseMessage.classList.remove('hidden')
        responseMessage.classList.remove('text-orange')
        responseMessage.classList.add('text-green')
        responseMessage.innerHTML = `${data.message} ðŸŒŠ`
      }

      form?.reset()
    }

    // Submit event listener
    form?.addEventListener('submit', submit)
  })
</script>
